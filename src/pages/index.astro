---
import Layout from "../layouts/BaseLayout.astro";

const sections = await Astro.glob("../../content/sections/*.md");
sections.sort((a, b) => (a.frontmatter.order ?? 0) - (b.frontmatter.order ?? 0));

const events = await Astro.glob("../../content/events/*.md");
events.sort((a, b) => new Date(a.frontmatter.date) - new Date(b.frontmatter.date));
---
<Layout title="Oxbridge Austria">
  <Fragment slot="nav">
    <nav>
      <ul class="flex gap-6 text-sm font-medium text-oxblue">
        {sections.map((s) => (
          <li>
            <a href={`#${s.frontmatter.title.toLowerCase().replace(/\s+/g, "-")}`} class="hover:text-oxgold transition-colors">
              {s.frontmatter.title}
            </a>
          </li>
        ))}
      </ul>
    </nav>
  </Fragment>

  {sections.map((section) => (
    <section id={section.frontmatter.title.toLowerCase().replace(/\s+/g, "-")} class="scroll-mt-24">
      <h2 class="text-3xl font-semibold text-oxblue mb-4 border-b border-oxblue/20 pb-2">
        {section.frontmatter.title}
      </h2>

      {section.frontmatter.image && (
        <img src={section.frontmatter.image} alt={section.frontmatter.title} class="rounded-xl shadow-sm mb-6" />
      )}

      <div class="prose prose-lg max-w-none font-serif text-gray-800 leading-relaxed" set:html={section.compiledContent()} />

      {section.frontmatter.title.toLowerCase() === "events" && (
        <ul class="space-y-8 mt-8">
          {events.map((e) => (
            <li class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
              {e.frontmatter.image && (
                <img src={e.frontmatter.image} alt={e.frontmatter.title} class="rounded-lg mb-4" />
              )}
              <h3 class="text-xl font-semibold text-oxblue mb-1">{e.frontmatter.title}</h3>
              <p class="text-sm text-gray-600 mb-2">
                {new Date(e.frontmatter.date).toLocaleDateString("en-GB", {
                  year: "numeric",
                  month: "short",
                  day: "numeric",
                })}
                {e.frontmatter.time ? ` · ${e.frontmatter.time}` : ""}
                {e.frontmatter.location ? ` · ${e.frontmatter.location}` : ""}
              </p>
              <div class="prose font-serif text-gray-700" set:html={e.compiledContent()} />
            </li>
          ))}
        </ul>
      )}
    </section>
  ))}

  <script>
    document.documentElement.style.scrollBehavior = "smooth";
  </script>
</Layout>
